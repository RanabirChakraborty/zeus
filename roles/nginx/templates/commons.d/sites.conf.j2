server_name {{ ansible_nodename }}; 
root /usr/share/nginx/html;

location / {
  error_page 404 /index.html;
  index /index.html;
} 

{% if nginx.caches is defined %}{% for cache in nginx.caches.entry %}location {{ cache.path }} {
   include /etc/nginx/commons.d/maven.cache.conf;
   proxy_pass {{ cache.url }};
}

{% endfor %}{% endif %}

{% if monit_webapp_password is defined %}
location /monit/ {
  auth_basic           "closed site";
  auth_basic_user_file /etc/nginx/monit.passwd;

  proxy_pass http://podman.host:2812/;
  proxy_redirect     off;
  include /etc/nginx/commons.d/proxy.conf;
}
{% endif %}

{% if jenkins is defined %}
location /jenkins {
  add_header X-Cache-Status $upstream_cache_status;

  proxy_pass http://{{ jenkins.bind_addr }}:{{ jenkins.port }} ;
  proxy_redirect     http://{{ jenkins.bind_addr }}:{{ jenkins.port }} https://{{ jenkins.bind_addr }};
  include /etc/nginx/commons.d/proxy.conf;
}
{% endif %}

# redirect server error pages to the static page /50x.html
error_page   500 502 503 504  /50x.html;
location = /50x.html {
    root   /usr/share/nginx/html;
}
